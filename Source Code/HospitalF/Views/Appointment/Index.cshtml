@using HospitalF.Constant
@model HospitalF.Models.AppointmentModels
@Scripts.Render("~/bundles/smartadminjquery")
<script src="~/Content/js/plugin/masked-input/jquery.maskedinput.min.js" type="text/javascript"></script>
@* Captcha Ajax API*@
<script type="text/javascript" src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js"></script>
<script type="text/javascript">
    
    $(function () {
        $(".datepicker").mask("99/99/9999");
        $("#txtDate").mask("99/99/9999");
        //$("#phoneNo").mask("9999-999-9999");
        $("#starttime").mask('99:99');
    });
    $(document).ready(function () {

        

        @*AJAX for cascading Doctor drop down list*@
        $("#SpecialityID").change(function () {
            var selectedItem = $(this).val();
            var ddlDoctor = $("#DoctorID");
            var statesProgress = $("#states-loading-doctor-progress");
            statesProgress.show();
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl(Constants.GetDoctorBySpecialiyMethod))",
                data: { "specialityID": selectedItem },
                success: function (data) {
                    ddlDoctor.html('');
                    ddlDoctor.append($('<option></option>').val(0).html("-- Xin chọn bác sĩ --"));
                    $.each(data, function (id, option) {
                        ddlDoctor.append($('<option></option>').val(option.id).html(option.name));
                    });
                    statesProgress.hide();
                    disableDays = AllDays;
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    statesProgress.hide();
                }
            });
        });

        // AJAX for cascading Doctor's working days datepicker
        var AllDays = [8, 2, 3, 4, 5, 6, 7];
        var disableDays=AllDays;
        var date = new Date();
        var currentMonth = date.getMonth();
        var currentDate = null;
        var currentYear = date.getFullYear();
        if (date.getHours() >= 22) {
            currentDate = date.getDate() + 1;
        } else {
            currentDate = date.getDate();
        }
        $("#DoctorID").change(function () {
            var selectedItem = $(this).val();
            var txtDate = $("#txtDate");
            var statesProgress = $("#states-loading-doctor-progress");
            statesProgress.show();
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl(Constants.GetDoctorWorkingDayMethod))",
                data: { "doctorID": selectedItem },
                success: function (data) {
                        disableDays = data;
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    disableDays = AllDays;
                    statesProgress.hide();
                }
            });
        });
        // Ngay kham datepicker
        $("#txtDate").datepicker({
            dateFormat: "mm/dd/yy",
            minDate: new Date(currentYear, currentMonth, currentDate),
            beforeShowDay: function ShowDisableDates(date) {
                var ymd = date.getFullYear() + "/" + ("0" + (date.getMonth() + 1)).slice(-2) + "/" + ("0" + date.getDate()).slice(-2);
                day = new Date(ymd).getDay();
                if ($.inArray(AllDays[day], disableDays) < 0) {
                    return [false, "disabled"];
                } else {
                    return [true, "enable"];
                }
            }
        });
        // birthday datepicker
        $(".datepicker").datepicker({
            dateFormat: "dd/mm/yy",
            maxDate: new Date(currentYear, currentMonth, currentDate - 1)
        });
        //
        $("#timepicker").timepicker();
    });

    //Recaptcha create method
    function showRecaptcha(element) {
        Recaptcha.create("6Lf5z_USAAAAAOm0zPB22hKqEdxzovQlGma7gaoV", element, {
            theme: "white",
            callback: Recaptcha.focus_response_field,
            custom_translations: { instructions_visual: "Nhập ký tự" }
        });
    }

    var a = Math.ceil(Math.random() * 100);
    var b = Math.ceil(Math.random() * 100);
    var c = a + b
    function DrawBotBoot() {
        document.write("" + a + " + " + b + "= ");
        document.write("<input id='BotBootInput' type='text' maxlength='2' size='2' onblur='ValidBotBoot();'/>");
    }
    function ValidBotBoot() {
        var d = document.getElementById('BotBootInput').value;
        if (d != c) {
            document.write("<label color='red'>Sai rồi</lable>");
        }

    }
</script>


<h2>CreateAppointment</h2>
<article class="col-sm-12 col-md-12 col-lg-7" style="margin-left: 20%;">

    <!-- Widget ID (each widget will need unique ID)-->
    <div class="jarviswidget" id="wid-id-1" data-widget-editbutton="false" data-widget-custombutton="false">
        @using (Html.BeginForm(Constants.IndexMethod, Constants.AppointmentController,
                FormMethod.Post, new { @class = "smart-form" }))
        {
            <div>
                <img style="width:100%;" src="~/Content/img/Appointment_Banner.jpg"/>
            </div>
            <h3>Đặt Hẹn Khám Bệnh</h3>
            <div style="float: left; width: 50%;">
                <fieldset>
                    <h3>Thông tin bệnh nhân</h3>

                    <div class="row">
                        <section class="col col-6">
                            <label class="select">
                                <select name="Speciality">
                                    <option value="-1" selected="" disabled="">Giới tính</option>
                                    <option value="0">Nam</option>
                                    <option value="1">Nữ</option>
                                </select>
                                <i></i>
                            </label>
                        </section>
                    </div>
                    <div class="row">

                        <section class="col col-6">
                            <label class="input">
                                <i class="icon-append fa fa-calendar"></i>
                                @Html.TextBoxFor(m => m.Birthday, new
                       {
                           @class = "datepicker",
                           @placeholder = "Ngày sinh"
                       })
                                 @Html.ValidationMessageFor(m=>m.Birthday)
                            </label>
                        </section>
                        <section class="col col-9">
                            <label class="input">
                                <i class="icon-prepend fa fa-user"></i>
                                @Html.TextBoxFor(m => m.FullName, new
                       {
                           @placeholder = "Họ tên"
                       })
                            </label>
                        </section>
                        <section class="col col-9">
                            <label class="input">
                                <i class="icon-prepend fa fa-envelope-o"></i>
                                @Html.TextBoxFor(m => m.Email, new
                           {
                               @placeholder = "E-mail"
                           })
                                 @Html.ValidationMessageFor(m=>m.Email)
                            </label>
                        </section>
                        <section class="col col-9">
                            <label class="input">
                                <i class="icon-prepend fa fa-phone"></i>
                                @Html.TextBoxFor(m => m.PhoneNo, new
                           {
                               @id = "phoneNo",
                               @placeholder = "Số điện thoại"
                           })
                                 @Html.ValidationMessageFor(m=>m.PhoneNo)
                            </label>
                        </section>
                    </div>
                </fieldset>
                @*</div>*@
                <!-- end widget content -->

            </div>
            <div style="float: right; width: 50%;">
                <fieldset>
                    <h3>Thông tin đặt hẹn</h3>
                    <div class="row">
                        <section class="col col-9">
                            <label class="input">
                                <i class="icon-prepend fa fa-user"></i>
                                <input type="text" value="Bệnh viện Hoàn Mỹ" readonly />
                            </label>
                        </section>

                        <section class="col col-9">
                            <label class="select">
                                @Html.DropDownListFor(m => m.SpecialityID, (SelectList)ViewBag.SpecialityList,
                                                Constants.RequireSpeciality)
                                @Html.ValidationMessageFor(m => m.SpecialityID)
                                <i></i>
                            </label>
                        </section>
                    </div>
                    <div class="row">
                        <section class="col col-9">
                            <label class="select">
                                @Html.DropDownListFor(m => m.DoctorID, (SelectList)ViewBag.DoctorList,
                                                Constants.RequireDoctor)
                                @Html.ValidationMessageFor(m => m.DoctorID)
                                <i></i>
                            </label>
                        </section>

                        <section class="col col-6">
                            <label class="input">
                                <i class="icon-append fa fa-calendar"></i>
                                @Html.TextBoxFor(m => m.AppDate, new
                                        {
                                            @id = "txtDate",
                                            @placeholder = "Ngày khám"
                                        })
                                
                                @Html.ValidationMessageFor(m => m.AppDate)
                            </label>
                        </section></div>
                    <div class="row">
                        <section class="col col-6">
                            <label class="input">
                                <i class="icon-append fa fa-clock-o"></i>
                                @Html.TextBoxFor(m => m.StartTime, new
                                        {
                                            @class = "form-control",
                                            @id="starttime",
                                            @placeholder = "Thời gian khám"
                                        })
                                
                                @Html.ValidationMessageFor(m => m.StartTime)
                            </label>
                        </section>
                        @*<section class="col col-9">
                            <div id="recaptcha_div"></div>
                            <input type="button" value="Show reCAPTCHA" onclick="showRecaptcha('recaptcha_div');"></input>

                            <script type="text/javascript">DrawBotBoot()</script>
                        </section>*@
                    </div>


                </fieldset>
            </div>
            <footer>
                <button type="reset" class="btn btn-primary">
                    Hủy
                </button>&nbsp;
                <button type="submit" class="btn btn-primary">
                    Đặt lịch khám
                </button>
            </footer>
        }
    </div>
</article>
