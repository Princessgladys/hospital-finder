@using HospitalF.Constant
@model HospitalF.Models.HomeModels

<div id="content" class="col-md-8 col-md-offset-2">
    <div id="main-logo">
        <img src="../Content/img/hospital-icon.png" style="visibility: hidden; width: 25%; height: 25%;" />
    </div>

    <div class="well" style="background-color: white;">
        <ul id="myTab1" class="nav nav-tabs bordered">
            <li class="active">
                <a href="#s1" data-toggle="tab"><i class="fa fa-fw fa-lg fa-search"></i>&nbsp;Tìm Kiếm Cơ Bản</a>
            </li>
            <li>
                <a href="#s2" data-toggle="tab"><i class="fa fa-fw fa-lg fa-plus-square"></i>&nbsp;Tìm Kiếm Theo Vị Trí</a>
            </li>
            <li>
                <a href="#s3" data-toggle="tab"><i class="fa fa-fw fa-lg fa-crosshairs"></i>&nbsp;Tìm Kiếm Nâng Cao</a>
            </li>
        </ul>

        <div id="myTabContent1" class="tab-content padding-10">
            <div class="tab-pane fade in active" id="s1">
                @using (Html.BeginForm(Constants.SearchResultMethod, Constants.HomeController, FormMethod.Get, new { @class = "form-horizontal", @id = "normal-search-form" }))
                {
          
                    <fieldset>
                        <legend>Nhập từ khóa về bệnh viện</legend>
                    </fieldset>
                    <div class="input-group">
                        @Html.TextBoxFor(m => m.SearchValue, new
                       {
                           @class = "form-control",
                           @placeholder = "Nhập thông tin tìm kiếm...",
                           @list = "list",
                           @id = "sentece-tag"
                       })

                        <div class="input-group-btn">
                            <button class="btn btn-default btn-primary" type="submit">
                                <i class="fa fa-search"></i>&nbsp;Tìm Kiếm
                            </button>
                        </div>
                    </div>
                    <p class="note"><strong>Ví dụ:</strong> chuyên khoa, tên bệnh viện, địa điểm...</p>
                }
            </div>

            <div class="tab-pane fade" id="s2">
                @using (Html.BeginForm(Constants.SearchResultMethod, Constants.HomeController, FormMethod.Get, new { @class = "smart-form", @id = "advanced-search-form" }))
                {
                    <fieldset>
                        <legend>Nhập thông tin vị trí</legend>
                        <div class="row">
                            <label class="label col col-2">Tìm Theo</label>
                            <section class="col col-4">
                                <label class="select">
                                    <select name="month">
                                        <option>Vị trí hiện tại</option>
                                        <option>Nhập vị trí</option>
                                    </select>
                                    <i></i>
                                </label>
                            </section>
                            <label class="label col col-2">Vị trí</label>
                            <section class="col col-4">
                                <label class="input">
                                    <i class="icon-append fa fa-location-arrow"></i>
                                    <input name="position" type="text" placeholder="Vị trí cần tìm...">
                                    <b class="tooltip tooltip-top-right">Nhập vị trí cần tìm</b>
                                </label>
                            </section>
                        </div>
                    </fieldset>
                    <footer>
                        <button class="btn btn-primary" type="submit">
                            <i class="fa fa-search"></i>&nbsp;
                                        Tìm Kiếm
                        </button>
                    </footer>
                }
            </div>

            <div class="tab-pane fade" id="s3">
                <form class="smart-form">
                    <fieldset>
                        <legend>Nhập thông tin bệnh viện</legend>
                        <div class="row">
                            <label class="label col col-2">Tỉnh / Thành phố</label>
                            <section class="col col-4">
                                <label class="select">
                                    @Html.DropDownListFor(m => m.CityID, (SelectList)ViewBag.CityList,
                                                Constants.RequireCity, new { @class = "form-control" })
                                    <i></i>
                                </label>
                            </section>
                            <label class="label col col-2">Quận / Huyện</label>
                            <section class="col col-4">
                                <label class="select">
                                    @Html.DropDownListFor(m => m.DistrictID, (SelectList)ViewBag.DistrictList,
                                                Constants.RequireDistrict, new { @class = "form-control" })
                                    <i></i>
                                </label>
                            </section>
                        </div>
                        <div class="row">
                            <label class="label col col-2">Chuyên khoa</label>
                            <section class="col col-4">
                                <label class="select">
                                    @Html.DropDownListFor(m => m.SpecialityID, (SelectList)ViewBag.SpecialityList,
                                                Constants.RequireSpeciality, new { @class = "form-control" })
                                    <i></i>
                                </label>
                            </section>
                            <label class="label col col-2">Triệu chứng</label>
                            <section class="col col-4">
                                <label class="input">
                                    <i class="icon-append fa fa-plus-square"></i>
                                    @Html.TextBoxFor(m => m.DiseaseName, new
                                       {
                                           @class = "form-control",
                                           @placeholder = "Triệu chứng...",
                                           @id = "disease-tag"
                                       })
                                    <b class="tooltip tooltip-top-right">Triệu chứng bệnh</b>
                                </label>
                            </section>
                        </div>
                    </fieldset>
                    <footer>
                        <button class="btn btn-primary" type="submit">
                            <i class="fa fa-search"></i>&nbsp;
                                        Tìm Kiếm
                        </button>
                    </footer>
                </form>
            </div>

        </div>
    </div>
</div>

@*AJAX for cascading District and Disease drop down list*@
<script type="text/javascript">
    @*AJAX for auto completing Disease textbox*@
    $(document).ready(function () {
        $("#sentece-tag").on('input', function () {
            var statesProgress = $("#states-loading-search-progress");
            var availableTags = new Array();
            statesProgress.show();
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl(Constants.LoadSuggestSentenceMethod))",
                success: function (data) {
                    $.each(data, function (id, option) {
                        availableTags.push(option);
                    });
                    statesProgress.hide();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    statesProgress.hide();
                }
            });
            $("#sentece-tag").autocomplete({
                source: function (request, response) {
                    var results = $.ui.autocomplete.filter(availableTags, request.term);
                    response(results.slice(0, 5));
                }
            });
        });
    });

    @*AJAX for auto completing Disease textbox*@
    $(document).ready(function () {
        $("#SpecialityID").change(function () {
            var selectedItem = $(this).val();
            var statesProgress = $("#states-loading-disease-progress");
            var availableTags = new Array();
            statesProgress.show();
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl(Constants.GetDeseaseBySpecialityMethod))",
                data: { "specialityId": selectedItem },
                success: function (data) {
                    $.each(data, function (id, option) {
                        availableTags.push(option.name);
                    });
                    statesProgress.hide();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    statesProgress.hide();
                }
            });
            //$("#disease-tag").autocomplete({
            //    source: function (request, response) {
            //        var results = $.ui.autocomplete.filter(availableTags, request.term);
            //        response(results.slice(0, 5));
            //    }
            //});
            $("#disease-tag").autocomplete({
                source: availableTags
            });
        });
    });

    @*AJAX for cascading District drop down list*@
    $(document).ready(function () {
        $("#CityID").change(function () {
            var selectedItem = $(this).val();
            var ddlDistrict = $("#DistrictID");
            var statesProgress = $("#states-loading-district-progress");
            statesProgress.show();
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl(Constants.GetDistrictByCityMethod))",
                data: { "cityId": selectedItem },
                success: function (data) {
                    ddlDistrict.html('');
                    $.each(data, function (id, option) {
                        ddlDistrict.append($('<option></option>').val(option.id).html(option.name));
                    });
                    statesProgress.hide();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    statesProgress.hide();
                }
            });
        });
    });
</script>

<script type="text/javascript">
    $(function () {
        $('#advanced-search-form').validate({
            // Rules for form validation
            rules: {
                position: {
                    required: true,
                    minlength: 5
                }
            },

            // Messages for form validation
            messages: {
                position: {
                    required: 'Không nhập sao biết đường tìm',
                    minlength: 'Ngắn quá trời'
                }
            },

            // Do not change code below
            errorPlacement: function (error, element) {
                error.insertAfter(element.parent());
            }
        });
    });
</script>
